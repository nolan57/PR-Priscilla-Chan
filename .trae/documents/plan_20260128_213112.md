# Batch NPZ Builder Script

## Overview
Create a new script `build_npzs_batch.py` that recursively processes WAV files in a directory structure while maintaining directory consistency across input (WAV, TextGrid, F0) and output directories, with enhanced file existence checks.

## Implementation Steps

### 1. Create New Script File
- Create `build_npzs_batch.py` in the same directory as `build_npzs.py`

### 2. Import Dependencies
- Import necessary modules: `os`, `argparse`, `Path`
- Import `build_single_npz` function from `build_npzs` for processing individual files

### 3. Command-Line Argument Parsing
- Maintain existing arguments: `--wav_dir`, `--textgrid_dir`, `--f0_dir`, `--output_dir`, `--use_external_f0`, `--speaker_id`
- Validate that all input directories exist

### 4. Recursive Processing Logic
- Use `os.walk` to traverse `wav_dir` recursively
- For each WAV file found:
  - Compute relative path from `wav_dir`
  - Construct corresponding TextGrid path: `textgrid_dir/relative_path/filename.TextGrid`
  - Check if TextGrid file exists (skip if not found)
  - If `--use_external_f0` is enabled, construct corresponding F0 path: `f0_dir/relative_path/filename.f0.npy`
  - Check if F0 file exists (fall back to pyin if not found)
  - Construct output path: `output_dir/relative_path/filename.npz`
  - Create output subdirectory if it doesn't exist
  - Call `build_single_npz` with appropriate paths

### 5. Progress Reporting & Error Handling
- Add detailed progress reporting
- Track total files, skipped files, and successful processing
- Handle errors gracefully while continuing batch processing
- Provide clear feedback on missing files

## Key Features
- Recursive processing of directory structures
- Maintains directory consistency across all input/output directories
- Enhanced file existence checks for both TextGrid and F0 files
- Reuses existing single-file processing logic
- Provides comprehensive progress and error reporting
- Supports all existing functionality of `build_npzs.py`

## Usage Example
```bash
python build_npzs_batch.py --wav_dir /path/to/wav --textgrid_dir /path/to/textgrid --output_dir /path/to/output --use_external_f0 --f0_dir /path/to/f0
```